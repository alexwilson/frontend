{"componentChunkName":"component---src-templates-article-js","path":"/content/a9c36f43-57cb-4e17-b284-43546c834b1c","result":{"data":{"content":{"contentId":"a9c36f43-57cb-4e17-b284-43546c834b1c","title":"Using IPv6 in Amazon Web Services","author":{"name":"alex"},"topics":[{"topicId":"491e6b8c-abac-5f70-b573-9ed982f02796","topic":"aws","slug":"/topic/aws"}],"date":"Sun Jan 01 2017 22:34:00 GMT+0000 (Coordinated Universal Time)","image":{"image":null,"credit":null},"content":{"html":"<p>Years in the works, in December Amazon beat both Google and Microsoft to introducing support for IPv6\nnetworking to their compute offering!  This is fantastic news, and I recommend reading <a href=\"https://aws.amazon.com/blogs/aws/new-ipv6-support-for-ec2-instances-in-virtual-private-clouds/\">Jeff Barr's\npost for more</a>.</p>\n<p>Unfortunately my excitement died down a bit after finding that there isn't yet much information about\ngetting off the ground with IPv6.  Ultimately it was pretty intuitive but it did require a bit of fumbling\naround in the AWS console.  I've documented the full process here, so hopefully I'll be able to save you\nsome time!</p>\n<h4>AWS abbreviations</h4>\n<ul>\n<li><em>AZ - Availability Zone</em></li>\n<li><em>EC2 - Elastic Compute Cloud</em></li>\n<li><em>IGW - Internet Gateway</em></li>\n<li><em>SG - Security Group</em></li>\n<li><em>VPC - Virtual Private Cloud</em></li>\n</ul>\n<h2>Configuring a VPC to support IPv6</h2>\n<h4><em>Note: Currently this is only available in the Ohio region (us-east-2) .</em></h4>\n<h3>1) Add IPv6 CIDR to the VPC itself</h3>\n<ul>\n<li>By default everybody gets one VPC per region.  If you've set-up other VPCs, these instructions\nwill still work - you will just need to replicate custom routing in step #4.</li>\n<li>Every default VPC comes with a default IPv4 /16.</li>\n<li>On the \"Edit CIDRs\" page for each VPC, it's possible to allocate an IPv6 /56 to your VPC.\nNote that this is random, and unlike the IPv4 /16 which is strictly internal, this CIDR is\ncomprised of public IP addresses.</li>\n</ul>\n<h3>2) Add IPv6 to VPC subnets</h3>\n<ul>\n<li>By default there's one subnet per Availability Zone, IPv4 only</li>\n<li>Associate a subnet of the IPv6 CIDR we've just assigned to the VPC</li>\n</ul>\n<h3>3) Enable IPv6 auto-assign in subnets</h3>\n<ul>\n<li>By default each subnet will auto-allocate IPv4</li>\n<li>From auto-assign IP settings, enable IPv6</li>\n</ul>\n<h3>4) Update VPC route table to add IPv6 route to the IGW.</h3>\n<ul>\n<li>By default, VPC route tables have <code class=\"language-text\">0.0.0.0/0</code> routed through a default Internet Gateway.</li>\n<li>We want to add a route with a Destination of <code class=\"language-text\">::/0</code> through the IGW.</li>\n</ul>\n<h3>5) Adjust Security Groups to allow IPv6 connections.</h3>\n<ul>\n<li>Both newly created and historic SGs come with IPv4 rules pre-configured.</li>\n<li>You will want to add new rules for inbound and outbound IPv6 connectivity.</li>\n<li>Same pattern as before, and in regions which support IPv6 you'll find that new defaults\nhave been added for IPv6 wildcards.  Unfortunately, you will have to double-up on rules.</li>\n<li>For inbound traffic, you can edit your existing rules and add the appropriate IPv6 CIDR to the end,\nseparated by a comma.  e.g. <code class=\"language-text\">0.0.0.0/0</code> becomes <code class=\"language-text\">0.0.0.0/0, ::/0</code>.</li>\n<li>Concerning outbound IPv6, it may be set up by default, if so you can safely skip the rest of this.</li>\n<li>You should be safe to allow all outbound traffic, using the same IPv6 CIDR as above!</li>\n<li>When altering existing outbound SG rules, at the very least make sure to enable IPv6 ICMP\ntraffic, as it is used to replace ARP in IPv6!  Unfortunately I learned this the hard way :(</li>\n</ul>\n<p>That's it, you're done!\nCongratulations, your region is now IPv6 enabled.\nBefore you can use this with Compute resources there may be a little more set-up required...</p>\n<h2>Using IPv6 in Compute</h2>\n<p>Most EC2 images will not support IPv6 out of the box, as AWS assigns IPv6 via DHCPv6 (and not SLAAC)\nand at time of writing only the AMI for Amazon Linux has been updated to support this.\nIn-time, it's inevitable others will follow!</p>\n<p>On a running instance you can do this manually with: <code class=\"language-text\">dhclient -v -6 -N</code>.\nHowever, to survive reboots, you will want to modify the definition of your network interface so that\nit can be assigned an IPv6 address via DHCP.</p>\n<h3>Debian / Ubuntu</h3>\n<p>On Debian-like systems such as Ubuntu this can be achieved by creating a definition in <code class=\"language-text\">/etc/network/interfaces.d/</code>.\n(On older systems you'll have to modify <code class=\"language-text\">/etc/network/interfaces</code> directly.)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">iface eth0 inet6 dhcp</code></pre></div>\n<p>You can automate this with userdata when creating a new image.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"iface eth0 inet6 dhcp\"</span> <span class=\"token operator\">></span> /etc/network/interfaces.d/99-eth0-ipv6-dhcp.cfg\n</code></pre></div>\n<h3>Redhat / CentOS</h3>\n<p>On Redhat systems such as CentOS this is a little different, and you'll need to edit the network\nscript for eth0. <code class=\"language-text\">/etc/sysconfig/network-scripts/ifcfg-eth0</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">IPV6INIT</span><span class=\"token operator\">=</span>yes\n<span class=\"token assign-left variable\">IPV6_AUTOCONF</span><span class=\"token operator\">=</span>no\n<span class=\"token assign-left variable\">DHCPV6C</span><span class=\"token operator\">=</span>yes</code></pre></div>\n<h2>Extras!</h2>\n<ul>\n<li>It's also possible to use IPv6 internally, and to completely prevent inbound internet traffic.\nThis involves the creation of a new \"Egress Only Internet Gateway\", which is essentially\nan IGW with a built in SG.\nAfter creating one of these, route \"::/0\" through this new gateway, instead of through a pre-existing one.</li>\n</ul>\n<h2>Conclusion</h2>\n<p>I will update this post with CloudFormation configuration as soon as it is possible, as well as with some further thoughts and reflections on using this as time goes on.</p>\n<p>As with everything, your mileage may vary.  That being said, if you have any questions or feedback, please don't hesitate to drop me a line.  I'm <code class=\"language-text\">@antoligy</code> on Twitter,  on Github and <code class=\"language-text\">alex</code> on StormBit.</p>","excerpt":"Years in the works, in December Amazon beat both Google and Microsoft to introducing support for IPv6\nnetworking to their compute offeringâ€¦"},"slug":"/content/a9c36f43-57cb-4e17-b284-43546c834b1c","deprecatedFields":{"legacySlugs":["/blog/2017/01/01/using-ipv6-in-aws/"]}},"site":{"siteMetadata":{"siteUrl":"https://alexwilson.tech"}}},"pageContext":{"contentId":"a9c36f43-57cb-4e17-b284-43546c834b1c"}},"staticQueryHashes":["2931102475","63159454"],"slicesMap":{}}